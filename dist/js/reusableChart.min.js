!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.reusableChart={},t.d3)}(this,function(t,y){"use strict";function o(n,i,r,a){if(n.fromFile)n.data.endsWith(".json")?y.json(n.data).then(function(t){r&&(console.log("Initial Data: "),console.log(t));var e=y.hierarchy(t);r&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):n.data.endsWith(".csv")?n.flatData?y.dsv(n.delimiter,n.data).then(function(t){r&&console.log(t);var e=d(t,n.hierarchyLevels,r);r&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):y.dsv(n.delimiter,n.data).then(function(t){r&&console.log(t);var e=l(t,n.keyField);r&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):console.log("File must end with .json or csv");else{var t=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=y.select(e).text().trim();return y.dsvFormat(t).parse(n)}(n.delimiter),e=n.flatData?d(t,n.hierarchyLevels,r):l(t,n.keyField);r&&(console.log("embedded data: "),console.log(e)),a(i,e)}}function l(t,e){return y.stratify().id(function(t){return t[e]}).parentId(function(t){return t.parent})(t)}function d(t,e,n){var i=y.nest();return e.forEach(function(e){return i.key(function(t){return t[e]})}),i=i.entries(t),y.hierarchy(i[0],function(t){var e=t.values;if(void 0===e)return null;e=e.filter(function(t){return void 0!==t.key&&0!==t.key.length}),n&&console.log("Key: "+t.key+" Children: "+e.length);return 0===e.length?null:e})}var v={},a=void 0,u=void 0,c=void 0;function n(t,e,n){var i,r,a,l={};l.width=1400-n.margin.right-n.margin.left,l.height=800-n.margin.top-n.margin.bottom,l.i=0,l.tree=void 0,l.root=void 0,l.svg=void 0,l.counter=0,l.svg=t.append("svg").attr("width",l.width+n.margin.right+n.margin.left).attr("height",l.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),g(n,l,e),h(n,l),r=l,a=e,(i=n).updateLinkWidth=function(){i.linkWidthStatic?r.tree.nodeSize([0,i.linkWidthValue]):h(i,r),L(r.root,i,r)},i.updateLinkHeight=function(){L(r.root,i,r)},i.updateLinkLabel=function(){L(r.root,i,r)},i.updateLinkStrength=function(){h(i,r),L(r.root,i,r)},i.updateLinkColor=function(){L(r.root,i,r)},i.updateAlignLeaves=function(){g(i,r,a),L(r.root,i,r)},L(l.root,n,l)}function g(e,n,t){n.tree=e.alignLeaves?y.cluster():y.tree(),n.tree.size([n.width,n.height]).nodeSize([0,e.linkWidthValue]),n.root=n.tree(t),e.propagate&&n.root.sum(function(t){return t[e.propagateField]}),n.root.each(function(t){t.name=t.id,t.id=n.i,n.i++,e.propagate&&(t.data[e.propagateField]=t.value)}),n.root.x0=n.root.x,n.root.y0=n.root.y,e.debugOn&&(console.log("Data:"),console.log(t),console.log("Tree:"),console.log(n.root))}function h(e,t){var n=t.root.descendants();e.linkStrengthStatic||e.linkStrengthScale.domain(y.extent(n.slice(1),function(t){return+t.data[e.linkStrengthField]})).range(e.linkStrengthRange),e.linkWidthStatic||e.linkWidthScale.domain(y.extent(n.slice(1),function(t){return+t.data[e.linkWidthField]})).range(e.linkWidthRange)}function L(t,r,a){a.width=800;var e=a.tree(a.root),n=[];e.eachBefore(function(t){n.push(t)}),a.height=Math.max(500,n.length*r.linkHeight+r.margin.top+r.margin.bottom);var i=n.slice(1);n.forEach(function(t,e){t.x=e*r.linkHeight,r.linkWidthStatic||0!==e&&(t.y=t.parent.y+r.linkWidthScale(+t.data[r.linkWidthField]))}),y.select("svg").transition().duration(r.transitionDuration).attr("height",a.height);var l=a.svg.selectAll("g.node").data(n,function(t){return t.id||(t.id=++a.i)}),o=l.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){return n=r,i=a,(e=t).children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),void L(e,n,i);var e,n,i});o.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data[r.keyField].length>r.maxNameLength?t.data[r.keyField].substring(0,r.maxNameLength)+"...":t.data[r.keyField]}).style("fill-opacity",1e-6),o.append("svg:title").text(function(t){return t.data[r.keyField]});var d=l.merge(o).transition().duration(r.transitionDuration);d.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),d.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),d.select("text").style("fill-opacity",1);var u=l.exit().transition().duration(r.transitionDuration);u.attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove(),u.select("circle").attr("r",1e-6),u.select("text").style("fill-opacity",1e-6);var c=v;c.initialize(r);var g=a.svg.selectAll("g.link").data(i,function(t){return t.id+"->"+t.parent.id}),h=g.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+t.y0+" "+t.x0+")"),s={x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}};h.append("path").attr("class","link down").attr("d",function(){return c.getLinkD(s,"down")}),h.append("path").attr("class","link right").attr("d",function(){return c.getLinkD(s,"right")}),h.append("text").attr("dy",".35em").attr("text-anchor","middle").text(c.getLinkLabel).style("opacity",1e-6);var k=g.merge(h).transition().duration(r.transitionDuration);k.attr("transform",function(t){return"translate("+t.parent.y+" "+t.parent.x+")"}),k.select("path.link.down").attr("d",function(t){return c.getLinkD(t,"down")}).style("stroke",function(t){return c.getLinkStroke(t.parent,r)}).style("stroke-width",function(t){return c.getLinkStrokeWidth(t.parent,r)}),k.select("path.link.right").attr("d",function(t){return c.getLinkD(t,"right")}).attr("transform",c.getLinkRTranslate).style("stroke",c.getLinkStroke).style("stroke-width",c.getLinkStrokeWidth),k.select("text").attr("x",function(t){return(t.y-t.parent.y)/2}).attr("y",function(t){return t.x-t.parent.x}).call(function(t){return t.tween("text",c.getLinkTextTween)}).style("opacity",1);var f=g.exit().transition().duration(r.transitionDuration).remove();f.attr("transform","translate("+t.y+" "+t.x+")");var p={x:t.x,y:t.y,parent:{x:t.x,y:t.y}};f.selectAll("path.link.down").attr("d",function(){return c.getLinkD(p,"down")}),f.selectAll("path.link.right").attr("d",function(){return c.getLinkD(p,"right")}).attr("transform","translate(0 0)"),f.select("text").attr("x",0).attr("y",0).style("opacity",1e-6),n.forEach(function(t){t.x0=t.x,t.y0=t.y})}v.initialize=function(t){u=c,c=(a=t).linkLabelOn?a.linkLabelField:void 0,a.debugOn&&(console.log("oldLabel:"),console.log(u),console.log("newLabel:"),console.log(c))},v.getLinkD=function(t,e){var n=v.getLinkStrength(t.parent,a),i=v.getLinkStrength(t,a),r=void 0;return"down"===e?r="M 0 0V"+(t.x+i/2-t.parent.x):"right"===e&&(r="M 0 0H"+(t.y-(t.parent.y+n/2))),r},v.getLinkStrength=function(t){return t.data?a.linkStrengthStatic?a.linkStrengthValue:a.linkStrengthScale(t.data[a.linkStrengthField]):0},v.getLinkStroke=function(t){return a.linkColorStatic?a.defaultColor:a.linkColorScale(t.data[a.linkColorField])},v.getLinkStrokeWidth=function(t){return(a.linkStrengthStatic?a.linkStrengthValue:a.linkStrengthScale(t.data[a.linkStrengthField]))+"px"},v.getLinkLabel=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkLabelField;return a.linkLabelOn?t.data[e]:""},v.getLinkTextTween=function(t){var e=y.select(this);if(!a.linkLabelOn)return function(){e.text("")};var n=v.getLinkLabel(t,u),i=v.getLinkLabel(t,c),r=y.interpolateNumber(n,i);return function(t){e.text(a.linkLabelFormat(r(t))+a.linkLabelUnit)}},v.getLinkRTranslate=function(t){return"translate("+v.getLinkStrength(t.parent)/2+" "+(t.x-t.parent.x)+")"};var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=function(r){var a={};function i(i){i.each(function(t){var e,n;console.log(t),console.log("dataSpec: "),console.log(r),void 0!==t?l(i,t):o((n={},"object"===(void 0===(e=r)?"undefined":s(e))?(n.data=e.source,n.hierarchyLevels=e.hierarchyLevels,n.keyField=e.key?e.key:n.hierarchyLevels?"key":"name",n.delimiter=e.delimiter?e.delimiter:","):console.log("dataspec is not an object!"),n.fromFile=void 0!==n.data,n.flatData=!!Array.isArray(n.hierarchyLevels),a.keyField=n.keyField,n),i,a.debugOn,l)})}function l(t,e){n(t,e,a)}return a.debugOn=!1,a.margin={top:20,right:10,bottom:20,left:10},a.maxNameLength=50,a.transitionDuration=750,a.defaultColor="grey",a.linkHeight=20,a.linkLabelField="value",a.linkLabelOn=!1,a.linkLabelUnit="",a.linkLabelFormat=y.format(".0f"),a.linkWidthStatic=!0,a.linkWidthValue=30,a.linkWidthScale=y.scaleLinear(),a.linkWidthField="value",a.linkWidthRange=[15,100],a.linkStrengthStatic=!0,a.linkStrengthValue=1,a.linkStrengthScale=y.scaleLinear(),a.linkStrengthField="value",a.linkStrengthRange=[1,10],a.linkColorStatic=!0,a.linkColorScale=function(t){return t},a.linkColorField="color",a.propagate=!1,a.propagateField="value",a.alignLeaves=!1,a.keyField=void 0,i.debugOn=function(t){return arguments.length?(a.debugOn=t,i):a.debugOn},i.defaultColor=function(t){return arguments.length?(a.defaultColor=t,"function"==typeof a.updateLinkColor&&a.updateLinkColor(),i):a.defaultColor},i.margin=function(t){return arguments.length?(a.margin=t,i):a.margin},i.maxNameLength=function(t){return arguments.length?(a.maxNameLength=t,i):a.maxNameLength},i.transitionDuration=function(t){return arguments.length?(a.transitionDuration=t,i):a.transitionDuration},i.propagateValue=function(t){return arguments.length?(a.propagate=!0,a.propagateField=t,i):a.propagate+": "+a.propagateField},i.linkHeight=function(t){return arguments.length?(a.linkHeight=t,"function"==typeof a.updateLinkHeight&&a.updateLinkHeight(),i):a.linkHeight},i.linkLabel=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkLabelField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkLabelUnit,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a.linkLabelFormat;return arguments.length?("string"==typeof t?(a.linkLabelField=t,a.linkLabelOn=!0,a.linkLabelUnit=""===e?"":e,a.linkLabelFormat=n):"boolean"==typeof t&&(a.linkLabelOn=t),"function"==typeof a.updateLinkLabel&&a.updateLinkLabel(),i):a.linkLabelField},i.linkWidth=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkWidthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkWidthScale,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a.linkWidthRange;return arguments.length?("number"==typeof t?(a.linkWidthStatic=!0,a.linkWidthValue=t):"string"==typeof t&&(a.linkWidthStatic=!1,a.linkWidthField=t,a.linkWidthScale=e,a.linkWidthRange=n),"function"==typeof a.updateLinkWidth&&a.updateLinkWidth(),i):a.linkWidthValue},i.linkStrength=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkStrengthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkStrengthScale,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a.linkStrengthRange;return arguments.length?("number"==typeof t?(a.linkStrengthStatic=!0,a.linkStrengthValue=t):"string"==typeof t&&(a.linkStrengthStatic=!1,a.linkStrengthField=t,a.linkStrengthScale=e,a.linkStrengthRange=n),"function"==typeof a.updateLinkStrength&&a.updateLinkStrength(),i):a.linkStrengthValue},i.linkColor=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a.linkColorField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.linkColorScale;return arguments.length?(a.linkColorStatic=!1,a.linkColorField=t,a.linkColorScale=e,"function"==typeof a.updateLinkColor&&a.updateLinkColor(),i):a.linkColorField},i.alignLeaves=function(t){return arguments.length?(a.alignLeaves=t,"function"==typeof a.updateAlignLeaves&&a.updateAlignLeaves(),i):a.alignLeaves},i},Object.defineProperty(t,"__esModule",{value:!0})});