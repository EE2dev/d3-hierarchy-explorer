!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],n):n(t.reusableChart={},t.d3)}(this,function(t,g){"use strict";function l(e,i,r,o){if(e.fromFile)e.data.endsWith(".json")?g.json(e.data).then(function(t){r&&(console.log("Initial Data: "),console.log(t));var n=g.hierarchy(t);r&&(console.log("hierarchy: "),console.log(n)),o(i,n)}):e.data.endsWith(".csv")?e.flatData?g.dsv(e.delimiter,e.data).then(function(t){r&&console.log(t);var n=c(t,e.hierarchyLevels,r);r&&(console.log("hierarchy: "),console.log(n)),o(i,n)}):g.dsv(e.delimiter,e.data).then(function(t){r&&console.log(t);var n=a(t,e.keyField);r&&(console.log("hierarchy: "),console.log(n)),o(i,n)}):console.log("File must end with .json or csv");else{var t=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",e=g.select(n).text().trim();return g.dsvFormat(t).parse(e)}(e.delimiter),n=e.flatData?c(t,e.hierarchyLevels,r):a(t,e.keyField);r&&(console.log("embedded data: "),console.log(n)),o(i,n)}}function a(t,n){return g.stratify().id(function(t){return t[n]}).parentId(function(t){return t.parent})(t)}function c(t,n,e){var i=g.nest();return n.forEach(function(n){return i.key(function(t){return t[n]})}),i=i.entries(t),g.hierarchy(i[0],function(t){var n=t.values;if(void 0===n)return null;n=n.filter(function(t){return void 0!==t.key&&0!==t.key.length}),e&&console.log("Key: "+t.key+" Children: "+n.length);return 0===n.length?null:n})}function e(t,n,e){var i,r,o,a={};a.width=1400-e.margin.right-e.margin.left,a.height=800-e.margin.top-e.margin.bottom,a.i=0,a.tree=void 0,a.root=void 0,a.svg=void 0,a.counter=0,a.svg=t.append("svg").attr("width",a.width+e.margin.right+e.margin.left).attr("height",a.height+e.margin.top+e.margin.bottom).append("g").attr("transform","translate("+e.margin.left+","+e.margin.top+")"),u(e,a,n),d(e,a),r=a,o=n,(i=e).updateLinkWidth=function(){i.linkWidthStatic?r.tree.nodeSize([0,i.linkWidthValue]):d(i,r),f(r.root,i,r)},i.updateLinkHeight=function(){f(r.root,i,r)},i.updateLinkStrength=function(){d(i,r),f(r.root,i,r)},i.updateLinkColor=function(){f(r.root,i,r)},i.updateAlignLeaves=function(){u(i,r,o),f(r.root,i,r)},f(a.root,e,a)}function u(n,e,t){e.tree=n.alignLeaves?g.cluster():g.tree(),e.tree.size([e.width,e.height]).nodeSize([0,n.linkWidthValue]),e.root=e.tree(t),n.propagate&&e.root.sum(function(t){return t[n.propagateField]}),e.root.each(function(t){t.name=t.id,t.id=e.i,e.i++}),e.root.x0=e.root.x,e.root.y0=e.root.y,n.debugOn&&(console.log("Data:"),console.log(t),console.log("Tree:"),console.log(e.root))}function d(n,t){var e=t.root.descendants();n.linkStrengthStatic||n.linkStrengthScale.domain(g.extent(e.slice(1),function(t){return+t[n.linkStrengthField]})).range(n.linkStrengthRange),n.linkWidthStatic||n.linkWidthScale.domain(g.extent(e.slice(1),function(t){return+t[n.linkWidthField]})).range(n.linkWidthRange)}function s(t,n){return"curved"===n?"M"+t.y+","+t.x+"C"+(t.y+t.parent.y)/2+","+t.x+" "+(t.y+t.parent.y)/2+","+t.parent.x+" "+t.parent.y+","+t.parent.x:"M"+t.parent.y+","+t.parent.x+"V"+t.x+"H"+t.y}function f(t,r,o){o.width=800;var n=o.tree(o.root),e=[];n.eachBefore(function(t){e.push(t)}),o.height=Math.max(500,e.length*r.linkHeight+r.margin.top+r.margin.bottom);var i=e.slice(1);e.forEach(function(t,n){t.x=n*r.linkHeight,r.linkWidthStatic||0!==n&&(t.y=t.parent.y+r.linkWidthScale(t[r.linkWidthField]))}),g.select("svg").transition().duration(r.transitionDuration).attr("height",o.height);var a=o.svg.selectAll("g.node").data(e,function(t){return t.id||(t.id=++o.i)}),l=a.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){return e=r,i=o,(n=t).children?(n._children=n.children,n.children=null):(n.children=n._children,n._children=null),void f(n,e,i);var n,e,i});l.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),l.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data[r.keyField].length>r.maxNameLength?t.data[r.keyField].substring(0,r.maxNameLength)+"...":t.data[r.keyField]}).style("fill-opacity",1e-6),l.append("svg:title").text(function(t){return t.data[r.keyField]});var c=a.merge(l).transition().duration(r.transitionDuration);c.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),c.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),c.select("text").style("fill-opacity",1);var u=a.exit().transition().duration(r.transitionDuration);u.attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove(),u.select("circle").attr("r",1e-6),u.select("text").style("fill-opacity",1e-6);var d=o.svg.selectAll("path.link").data(i,function(t){return t.id+"->"+t.parent.id}),h=d.enter().insert("path","g").attr("class","link").attr("d",function(){return s({x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}},r.linkFunction)});d.merge(h).transition().duration(r.transitionDuration).attr("d",function(t){return s(t,r.linkFunction)}).style("stroke-width",function(t){return r.linkStrengthStatic?r.linkStrengthValue+"px":r.linkStrengthScale(t.data[r.linkStrengthField])+"px"}).style("stroke",r.linkColorStatic?"grey":function(t){return r.linkColorScale(t.data[r.linkColorField])}),d.exit().transition().duration(r.transitionDuration).attr("d",function(){return s({x:t.x,y:t.y,parent:{x:t.x,y:t.y}},r.linkFunction)}).remove(),e.forEach(function(t){t.x0=t.x,t.y0=t.y})}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=function(r){var o={};function i(i){i.each(function(t){var n,e;console.log(t),console.log("dataSpec: "),console.log(r),void 0!==t?a(i,t):l((e={},"object"===(void 0===(n=r)?"undefined":h(n))?(e.data=n.source,e.hierarchyLevels=n.hierarchyLevels,e.keyField=n.key?n.key:e.hierarchyLevels?"key":"name",e.delimiter=n.delimiter?n.delimiter:","):console.log("dataspec is not an object!"),e.fromFile=void 0!==e.data,e.flatData=!!Array.isArray(e.hierarchyLevels),o.keyField=e.keyField,e),i,o.debugOn,a)})}function a(t,n){e(t,n,o)}return o.debugOn=!1,o.margin={top:20,right:10,bottom:20,left:10},o.maxNameLength=50,o.transitionDuration=750,o.linkFunction="straight",o.linkHeight=20,o.linkWidthStatic=!0,o.linkWidthValue=30,o.linkWidthScale=g.scaleLinear(),o.linkWidthField="value",o.linkWidthRange=[15,100],o.linkStrengthStatic=!0,o.linkStrengthValue=1,o.linkStrengthScale=g.scaleLinear(),o.linkStrengthField="value",o.linkStrengthRange=[1,10],o.linkColorStatic=!0,o.linkColorScale=function(t){return t},o.linkColorField="color",o.propagate=!1,o.propagateField="value",o.alignLeaves=!1,o.keyField=void 0,i.debugOn=function(t){return arguments.length?(o.debugOn=t,i):o.debugOn},i.margin=function(t){return arguments.length?(o.margin=t,i):o.margin},i.maxNameLength=function(t){return arguments.length?(o.maxNameLength=t,i):o.maxNameLength},i.transitionDuration=function(t){return arguments.length?(o.transitionDuration=t,i):o.transitionDuration},i.linkFunction=function(t){return arguments.length?(o.linkFunction=t,i):o.linkFunction},i.propagateValue=function(t){return arguments.length?(o.propagate=!0,o.propagateField=t,i):o.propagate+": "+o.propagateField},i.linkHeight=function(t){return arguments.length?(o.linkHeight=t,"function"==typeof o.updateLinkHeight&&o.updateLinkHeight(),i):o.linkHeight},i.linkWidth=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:o.linkWidthScale,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:o.linkWidthRange;return arguments.length?("number"==typeof t?(o.linkWidthStatic=!0,o.linkWidthValue=t):"string"==typeof t&&(o.linkWidthStatic=!1,o.linkWidthField=t,o.linkWidthScale=n,o.linkWidthRange=e),"function"==typeof o.updateLinkWidth&&o.updateLinkWidth(),i):o.linkWidthValue+", scale: "+o.linkWidthScale},i.linkStrength=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:o.linkStrengthScale,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:o.linkStrengthRange;return arguments.length?("number"==typeof t?(o.linkStrengthStatic=!0,o.linkStrengthValue=t):"string"==typeof t&&(o.linkStrengthStatic=!1,o.linkStrengthField=t,o.linkStrengthScale=n,o.linkStrengthRange=e),"function"==typeof o.updateLinkStrength&&o.updateLinkStrength(),i):o.linkStrengthValue+", scale: "+o.linkStrengthScale},i.linkColor=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:o.linkColorScale;return arguments.length?(o.linkColorStatic=!1,o.linkColorField=t,o.linkColorScale=n,"function"==typeof o.updateLinkColor&&o.updateLinkColor(),i):"scale: "+o.linkColorScale},i.alignLeaves=function(t){return arguments.length?(o.alignLeaves=t,"function"==typeof o.updateAlignLeaves&&o.updateAlignLeaves(),i):o.alignLeaves},i},Object.defineProperty(t,"__esModule",{value:!0})});