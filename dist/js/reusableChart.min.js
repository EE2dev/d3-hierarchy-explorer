!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],n):n(t.reusableChart={},t.d3)}(this,function(t,d){"use strict";function o(t,n,e,i){if(void 0!==t)if(t.endsWith(".json"))d.json(t).then(function(t){console.log(t),i(n,t)});else if(t.endsWith(".csv")){var r=[];console.log(r),i(n,r)}else console.log("File must end with .json or csv");else{var a=d.select("aside#data").text(),o=d.csvParse(a.replace(/^\s+|\s+$|\s+(?=\s)/g,""));o.forEach(function(t){!function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=+t[n])}(t)}),e&&console.log(o),i(n,o)}}function l(t,n,e){var i,r,a={};a.width=1400-e.margin.right-e.margin.left,a.height=800-e.margin.top-e.margin.bottom,a.i=0,a.tree=d.tree().size([a.width,a.height]).nodeSize([0,e.linkWidth]),a.root=a.tree(d.hierarchy(n)),e.propagate&&a.root.sum(function(t){return t[e.propagateField]}),a.svg=void 0,a.root.each(function(t){t.name=t.id,t.id=a.i,a.i++}),a.root.x0=a.root.x,a.root.y0=a.root.y,e.debugOn&&(console.log("Data:"),console.log(n),console.log("Tree:"),console.log(a.root)),e.linkScale.domain(d.extent(d.values(n,function(t){return t[e.propagateField]}))).range([1,e.linkWidth]),a.svg=t.append("svg").attr("width",a.width+e.margin.right+e.margin.left).attr("height",a.height+e.margin.top+e.margin.bottom).append("g").attr("transform","translate("+e.margin.left+","+e.margin.top+")"),r=a,(i=e).updateLinkWidth=function(){r.tree.nodeSize([0,i.linkWidth]),f(r.root,i,r)},i.updateLinkHeight=function(){f(r.root,i,r)},i.updateLinkStrength=function(){f(r.root,i,r)},f(a.root,e,a)}function s(t,n){return"curved"===n?"M"+t.y+","+t.x+"C"+(t.y+t.parent.y)/2+","+t.x+" "+(t.y+t.parent.y)/2+","+t.parent.x+" "+t.parent.y+","+t.parent.x:"M"+t.parent.y+","+t.parent.x+"V"+t.x+"H"+t.y}function f(t,r,a){a.width=800;var n=a.tree(a.root),e=[];n.eachBefore(function(t){e.push(t)}),a.height=Math.max(500,e.length*r.linkHeight+r.margin.top+r.margin.bottom);var i=e.slice(1);e.forEach(function(t,n){t.x=n*r.linkHeight}),d.select("svg").transition().duration(r.transitionDuration).attr("height",a.height);var o=a.svg.selectAll("g.node").data(e,function(t){return t.id||(t.id=++a.i)}),l=o.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){return e=r,i=a,(n=t).children?(n._children=n.children,n.children=null):(n.children=n._children,n._children=null),void f(n,e,i);var n,e,i});l.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),l.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data.name.length>r.maxNameLength?t.data.name.substring(0,r.maxNameLength)+"...":t.data.name}).style("fill-opacity",1e-6),l.append("svg:title").text(function(t){return t.data.name});var u=o.merge(l).transition().duration(r.transitionDuration);u.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),u.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),u.select("text").style("fill-opacity",1);var c=o.exit().transition().duration(r.transitionDuration);c.attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove(),c.select("circle").attr("r",1e-6),c.select("text").style("fill-opacity",1e-6);var g=a.svg.selectAll("path.link").data(i,function(t){return t.id+"->"+t.parent.id}),h=g.enter().insert("path","g").attr("class","link").attr("d",function(){return s({x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}},r.linkFunction)});g.merge(h).transition().duration(r.transitionDuration).attr("d",function(t){return s(t,r.linkFunction)}).style("stroke-width",r.linkStrength),g.exit().transition().duration(r.transitionDuration).attr("d",function(){return s({x:t.x,y:t.y,parent:{x:t.x,y:t.y}},r.linkFunction)}).remove(),e.forEach(function(t){t.x0=t.x,t.y0=t.y})}t.chart=function(e){var i={};function r(n){n.each(function(t){console.log(t),console.log("_myData "+e),void 0!==t?a(n,t):o(e,n,i.debugOn,a)})}function a(t,n){l(t,n,i)}return i.linkFunction="straight",i.linkWidth=30,i.linkHeight=50,i.linkStrengthValue=1,i.linkStrength=function(t,n){return"function"==typeof i.linkStrengthValue?i.linkStrengthValue(t,n)+"px":"number"==typeof i.linkStrengthValue?i.linkStrengthValue+"px":"1px"},i.propagate=!1,i.propagateField="value",i.linkScale=d.scaleLinear(),i.transitionDuration=750,i.maxNameLength=20,i.margin={top:20,right:10,bottom:20,left:10},i.barPadding=1,i.fillColor="coral",i.debugOn=!1,r.debugOn=function(t){return arguments.length?(i.debugOn=t,r):i.debugOn},r.linkFunction=function(t){return arguments.length?(i.linkFunction=t,r):i.linkFunction},r.transitionDuration=function(t){return arguments.length?(i.transitionDuration=t,r):i.transitionDuration},r.propagateValue=function(t){return arguments.length?(i.propagate=!0,i.propagateField=t,r):i.propagate+": "+i.propagateField},r.maxNameLength=function(t){return arguments.length?(i.maxNameLength=t,r):i.maxNameLength},r.margin=function(t){return arguments.length?(i.margin=t,r):i.margin},r.linkWidth=function(t){return arguments.length?(i.linkWidth=t,"function"==typeof i.updateLinkWidth&&i.updateLinkWidth(),r):i.linkWidth},r.linkHeight=function(t){return arguments.length?(i.linkHeight=t,"function"==typeof i.updateLinkHeight&&i.updateLinkHeight(),r):i.linkHeight},r.linkStrength=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:i.linkScale;return arguments.length?(i.linkStrengthValue=t,i.linkScale=n,"function"==typeof i.updateLinkStrength&&i.updateLinkStrength(),r):i.linkStrengthValue+", scale: "+i.linkScale},r},Object.defineProperty(t,"__esModule",{value:!0})});