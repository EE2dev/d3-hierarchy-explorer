!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.reusableChart={},t.d3)}(this,function(t,f){"use strict";function o(n,i,r,l){if(n.fromFile)n.data.endsWith(".json")?f.json(n.data).then(function(t){r&&(console.log("Initial Data: "),console.log(t));var e=f.hierarchy(t);r&&(console.log("hierarchy: "),console.log(e)),l(i,e)}):n.data.endsWith(".csv")?n.flatData?f.dsv(n.delimiter,n.data).then(function(t){r&&console.log(t);var e=c(t,n.hierarchyLevels,r);r&&(console.log("hierarchy: "),console.log(e)),l(i,e)}):f.dsv(n.delimiter,n.data).then(function(t){r&&console.log(t);var e=a(t,n.keyField);r&&(console.log("hierarchy: "),console.log(e)),l(i,e)}):console.log("File must end with .json or csv");else{var t=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=f.select(e).text().trim();return f.dsvFormat(t).parse(n)}(n.delimiter),e=n.flatData?c(t,n.hierarchyLevels,r):a(t,n.keyField);r&&(console.log("embedded data: "),console.log(e)),l(i,e)}}function a(t,e){return f.stratify().id(function(t){return t[e]}).parentId(function(t){return t.parent})(t)}function c(t,e,n){var i=f.nest();return e.forEach(function(e){return i.key(function(t){return t[e]})}),i=i.entries(t),f.hierarchy(i[0],function(t){var e=t.values;if(void 0===e)return null;e=e.filter(function(t){return void 0!==t.key&&0!==t.key.length}),n&&console.log("Key: "+t.key+" Children: "+e.length);return 0===e.length?null:e})}function n(t,e,n){var i,r,l,a={};a.width=1400-n.margin.right-n.margin.left,a.height=800-n.margin.top-n.margin.bottom,a.i=0,a.tree=void 0,a.root=void 0,a.svg=void 0,a.counter=0,a.svg=t.append("svg").attr("width",a.width+n.margin.right+n.margin.left).attr("height",a.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),d(n,a,e),u(n,a),r=a,l=e,(i=n).updateLinkWidth=function(){i.linkWidthStatic?r.tree.nodeSize([0,i.linkWidthValue]):u(i,r),S(r.root,i,r)},i.updateLinkHeight=function(){S(r.root,i,r)},i.updateLinkStrength=function(){u(i,r),S(r.root,i,r)},i.updateLinkColor=function(){S(r.root,i,r)},i.updateAlignLeaves=function(){d(i,r,l),S(r.root,i,r)},S(a.root,n,a)}function d(e,n,t){n.tree=e.alignLeaves?f.cluster():f.tree(),n.tree.size([n.width,n.height]).nodeSize([0,e.linkWidthValue]),n.root=n.tree(t),e.propagate&&n.root.sum(function(t){return t[e.propagateField]}),n.root.each(function(t){t.name=t.id,t.id=n.i,n.i++}),n.root.x0=n.root.x,n.root.y0=n.root.y,e.debugOn&&(console.log("Data:"),console.log(t),console.log("Tree:"),console.log(n.root))}function u(e,t){var n=t.root.descendants();e.linkStrengthStatic||e.linkStrengthScale.domain(f.extent(n.slice(1),function(t){return+t[e.linkStrengthField]})).range(e.linkStrengthRange),e.linkWidthStatic||e.linkWidthScale.domain(f.extent(n.slice(1),function(t){return+t[e.linkWidthField]})).range(e.linkWidthRange)}function k(t,e,n){var i=n.linkStrengthStatic?n.linkStrengthValue:"value"===n.linkStrengthField?n.linkStrengthScale(t.parent[n.linkStrengthField]):n.linkStrengthScale(t.parent.data[n.linkStrengthField]),r=n.linkStrengthStatic?n.linkStrengthValue:"value"===n.linkStrengthField?n.linkStrengthScale(t[n.linkStrengthField]):n.linkStrengthScale(t.data[n.linkStrengthField]),l=void 0;return"down"===e?l="M"+t.parent.y+","+t.parent.x+"V"+(t.x+r/2):"right"===e&&(l=l="M"+(t.parent.y+i/2)+","+t.x+"H"+t.y),l}function p(t,e){return e.linkColorStatic?e.defaultColor:e.linkColorScale(t.data[e.linkColorField])}function y(t,e){return e.linkStrengthStatic?e.linkStrengthValue+"px":"value"===e.linkStrengthField?e.linkStrengthScale(t[e.linkStrengthField])+"px":e.linkStrengthScale(t.data[e.linkStrengthField])+"px"}function S(t,r,l){l.width=800;var e=l.tree(l.root),n=[];e.eachBefore(function(t){n.push(t)}),l.height=Math.max(500,n.length*r.linkHeight+r.margin.top+r.margin.bottom);var i=n.slice(1);n.forEach(function(t,e){t.x=e*r.linkHeight,r.linkWidthStatic||0!==e&&(t.y=t.parent.y+r.linkWidthScale(t[r.linkWidthField]))}),f.select("svg").transition().duration(r.transitionDuration).attr("height",l.height);var a=l.svg.selectAll("g.node").data(n,function(t){return t.id||(t.id=++l.i)}),o=a.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){return n=r,i=l,(e=t).children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),void S(e,n,i);var e,n,i});o.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data[r.keyField].length>r.maxNameLength?t.data[r.keyField].substring(0,r.maxNameLength)+"...":t.data[r.keyField]}).style("fill-opacity",1e-6),o.append("svg:title").text(function(t){return t.data[r.keyField]});var c=a.merge(o).transition().duration(r.transitionDuration);c.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),c.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),c.select("text").style("fill-opacity",1);var d=a.exit().transition().duration(r.transitionDuration);d.attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove(),d.select("circle").attr("r",1e-6),d.select("text").style("fill-opacity",1e-6);var u=l.svg.selectAll("g.link").data(i,function(t){return t.id+"->"+t.parent.id}),h=u.enter().insert("g","g.node").attr("class","link");h.append("path").attr("class","link down").attr("d",function(){return k({x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}},"down",r)}),h.append("path").attr("class","link right").attr("d",function(){return k({x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}},"right",r)});var g=u.merge(h).transition().duration(r.transitionDuration);g.select("path.link.down").attr("d",function(t){return k(t,"down",r)}).style("stroke",function(t){return p(t.parent,r)}).style("stroke-width",function(t){return y(t.parent,r)}),g.select("path.link.right").attr("d",function(t){return k(t,"right",r)}).style("stroke",function(t){return p(t,r)}).style("stroke-width",function(t){return y(t,r)});var s=u.exit().transition().duration(r.transitionDuration).remove();s.selectAll("path.link.down").attr("d",function(){return k({x:t.x,y:t.y,parent:{x:t.x,y:t.y}},"down",r)}),s.selectAll("path.link.right").attr("d",function(){return k({x:t.x,y:t.y,parent:{x:t.x,y:t.y}},"right",r)}),n.forEach(function(t){t.x0=t.x,t.y0=t.y})}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=function(r){var l={};function i(i){i.each(function(t){var e,n;console.log(t),console.log("dataSpec: "),console.log(r),void 0!==t?a(i,t):o((n={},"object"===(void 0===(e=r)?"undefined":h(e))?(n.data=e.source,n.hierarchyLevels=e.hierarchyLevels,n.keyField=e.key?e.key:n.hierarchyLevels?"key":"name",n.delimiter=e.delimiter?e.delimiter:","):console.log("dataspec is not an object!"),n.fromFile=void 0!==n.data,n.flatData=!!Array.isArray(n.hierarchyLevels),l.keyField=n.keyField,n),i,l.debugOn,a)})}function a(t,e){n(t,e,l)}return l.debugOn=!1,l.margin={top:20,right:10,bottom:20,left:10},l.maxNameLength=50,l.transitionDuration=750,l.defaultColor="grey",l.linkHeight=20,l.linkWidthStatic=!0,l.linkWidthValue=30,l.linkWidthScale=f.scaleLinear(),l.linkWidthField="value",l.linkWidthRange=[15,100],l.linkStrengthStatic=!0,l.linkStrengthValue=1,l.linkStrengthScale=f.scaleLinear(),l.linkStrengthField="value",l.linkStrengthRange=[1,10],l.linkColorStatic=!0,l.linkColorScale=function(t){return t},l.linkColorField="color",l.propagate=!1,l.propagateField="value",l.alignLeaves=!1,l.keyField=void 0,i.debugOn=function(t){return arguments.length?(l.debugOn=t,i):l.debugOn},i.defaultColor=function(t){return arguments.length?(l.defaultColor=t,i):l.defaultColor},i.margin=function(t){return arguments.length?(l.margin=t,i):l.margin},i.maxNameLength=function(t){return arguments.length?(l.maxNameLength=t,i):l.maxNameLength},i.transitionDuration=function(t){return arguments.length?(l.transitionDuration=t,i):l.transitionDuration},i.propagateValue=function(t){return arguments.length?(l.propagate=!0,l.propagateField=t,i):l.propagate+": "+l.propagateField},i.linkHeight=function(t){return arguments.length?(l.linkHeight=t,"function"==typeof l.updateLinkHeight&&l.updateLinkHeight(),i):l.linkHeight},i.linkWidth=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:l.linkWidthScale,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:l.linkWidthRange;return arguments.length?("number"==typeof t?(l.linkWidthStatic=!0,l.linkWidthValue=t):"string"==typeof t&&(l.linkWidthStatic=!1,l.linkWidthField=t,l.linkWidthScale=e,l.linkWidthRange=n),"function"==typeof l.updateLinkWidth&&l.updateLinkWidth(),i):l.linkWidthValue+", scale: "+l.linkWidthScale},i.linkStrength=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:l.linkStrengthScale,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:l.linkStrengthRange;return arguments.length?("number"==typeof t?(l.linkStrengthStatic=!0,l.linkStrengthValue=t):"string"==typeof t&&(l.linkStrengthStatic=!1,l.linkStrengthField=t,l.linkStrengthScale=e,l.linkStrengthRange=n),"function"==typeof l.updateLinkStrength&&l.updateLinkStrength(),i):l.linkStrengthValue+", scale: "+l.linkStrengthScale},i.linkColor=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:l.linkColorScale;return arguments.length?(l.linkColorStatic=!1,l.linkColorField=t,l.linkColorScale=e,"function"==typeof l.updateLinkColor&&l.updateLinkColor(),i):"scale: "+l.linkColorScale},i.alignLeaves=function(t){return arguments.length?(l.alignLeaves=t,"function"==typeof l.updateAlignLeaves&&l.updateAlignLeaves(),i):l.alignLeaves},i},Object.defineProperty(t,"__esModule",{value:!0})});