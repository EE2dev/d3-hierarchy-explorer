!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.hierarchyExplorer={},t.d3)}(this,function(t,m){"use strict";function r(n,i,l,a){if(n.fromFile)n.data.endsWith(".json")?m.json(n.data).then(function(t){l&&(console.log("Initial Data: "),console.log(t));var e=m.hierarchy(t);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):n.data.endsWith(".csv")?n.flatData?m.dsv(n.delimiter,n.data).then(function(t){l&&console.log(t);var e=d(t,n.hierarchyLevels,n.keyField,l);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):m.dsv(n.delimiter,n.data).then(function(t){l&&console.log(t);var e=o(t,n.keyField);l&&(console.log("hierarchy: "),console.log(e)),a(i,e)}):console.log("File must end with .json or .csv");else{var t=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"aside#data",n=m.select(e).text().trim();return m.dsvFormat(t).parse(n)}(n.delimiter,n.data),e=n.flatData?d(t,n.hierarchyLevels,n.keyField,l):o(t,n.keyField);l&&(console.log("embedded data: "),console.log(e)),a(i,e)}}function o(t,e){return m.stratify().id(function(t){return t[e]}).parentId(function(t){return t.parent})(t)}function d(t,e,n,i){var l=m.nest();e.forEach(function(e){return l.key(function(t){return t[e]})}),l=l.map(t);var a={};return a[n]=l.keys()[0],function n(i,t,l){if(Array.isArray(t)){var e=t[0];for(var a in e)i[a]=e[a]}else t.entries().forEach(function(t){if(""===t[l])n(i,t.value);else{i.children=i.children?i.children:[];var e={};e[l]=t[l],i.children.push(n(e,t.value,l))}});return i}(a,l.get(l.keys()[0]),n),i&&(console.log("converted JSON:"),console.log(a)),m.hierarchy(a)}var L={},c=void 0,a=void 0,u=void 0,e=void 0;function g(t,e,n){var i={};i.width=n.svgDimensions.width-n.margin.right-n.margin.left,i.height=n.svgDimensions.height-n.margin.top-n.margin.bottom,i.i=0,i.tree=void 0,i.root=void 0,i.svg=void 0,i.counter=0,i.labelDimensions=[],i.svg=t.append("svg").attr("width",i.width+n.margin.right+n.margin.left).attr("height",i.height+n.margin.top+n.margin.bottom).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),l(n,i,e),s(n,i),function(t,e,n){t.updateLinkWidth=function(){t.linkWidthStatic?e.tree.nodeSize([0,t.linkWidthValue]):s(t,e),v(e.root,t,e)},t.updateLinkStrength=function(){s(t,e),v(e.root,t,e)},t.updateAlignLeaves=function(){l(t,e,n),v(e.root,t,e)},t.updateDefault=function(){v(e.root,t,e)}}(n,i,e),v(i.root,n,i)}function l(e,n,t){n.tree=e.alignLeaves?m.cluster():m.tree(),n.tree.size([n.width,n.height]).nodeSize([0,e.linkWidthValue]),n.root=n.tree(t),e.propagate&&n.root.sum(function(t){return t[e.propagateField]}),n.root.each(function(t){t.name=t.id,t.id=n.i,n.i++,e.propagate&&(t.data[e.propagateField]=t.value)}),n.root.x0=n.root.x,n.root.y0=n.root.y,e.propagate&&(e.propagate=!1),e.debugOn&&(console.log("Data:"),console.log(t),console.log("Tree:"),console.log(n.root))}function s(e,t){var n=t.root.descendants();e.linkStrengthStatic||e.linkStrengthScale.domain(m.extent(n,function(t){return+t.data[e.linkStrengthField]})).range(e.linkStrengthRange),e.linkWidthStatic||e.linkWidthScale.domain(m.extent(n.slice(1),function(t){return+t.data[e.linkWidthField]})).range(e.linkWidthRange)}function v(t,n,e){var i=e.tree(e.root),l=[];i.eachBefore(function(t){l.push(t)}),e.height=Math.max(500,l.length*n.linkHeight+n.margin.top+n.margin.bottom);var a=l.slice(1);l.forEach(function(t,e){t.x=e*n.linkHeight,n.linkWidthStatic||0!==e&&(t.y=t.parent.y+n.linkWidthScale(+t.data[n.linkWidthField]))}),m.select("svg").transition().duration(n.transitionDuration).attr("height",e.height);var r=e.svg.selectAll("g.node").data(l,function(t){return t.id||(t.id=++e.i)}),o=r.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+") scale(0.001, 0.001)"}).on("click",function(t){return function(t,e,n){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),v(t,e,n)}(t,n,e)});o.append("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.data[n.keyField].length>n.maxNameLength?t.data[n.keyField].substring(0,n.maxNameLength)+"...":t.data[n.keyField]}).style("fill-opacity",1e-6),o.append("svg:title").text(function(t){return t.data[n.keyField]});var d=r.merge(o).transition().duration(n.transitionDuration);d.attr("transform",function(t){return"translate("+t.y+","+t.x+") scale(1,1)"}),d.select("circle").style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),d.select("text").style("fill-opacity",1);var c=r.exit().transition().duration(n.transitionDuration);c.attr("transform",function(){return"translate("+t.y+","+t.x+") scale(0.001, 0.001)"}).remove(),c.select("text").style("fill-opacity",1e-6);var u=L;u.initialize(n);var g=e.svg.selectAll("g.link").data(a,function(t){return t.id+"->"+t.parent.id}),s=g.enter().insert("g","g.node").attr("class","link").attr("transform","translate("+t.y0+" "+t.x0+")"),h={x:t.x0,y:t.y0,parent:{x:t.x0,y:t.y0}};s.append("path").attr("class","link down").attr("d",function(){return u.getLinkD(h,"down")}),s.append("path").attr("class","link right").attr("d",function(){return u.getLinkD(h,"right")}),s.append("text").style("opacity",1e-6);var f=g.merge(s);f.select("text").attr("class",n.linkLabelOnTop?"label ontop":"label above").attr("text-anchor",n.linkLabelAligned?"end":"middle").attr("dy",u.getInitialDy).text(function(t){return u.getLinkLabelFormatted(t)}).style("fill",u.getLinkLabelColor);var k=f.transition().duration(n.transitionDuration);u.computeLabelDimensions(k.selectAll("text.label")),k.attr("transform",function(t){return"translate("+t.parent.y+" "+t.parent.x+")"}),k.select("path.link.down").attr("d",function(t){return u.getLinkD(t,"down")}).style("stroke",function(t){return u.getLinkStroke(t.parent)}).style("stroke-width",function(t){return u.getLinkStrokeWidth(t.parent)}),k.select("path.link.right").attr("d",function(t){return u.getLinkD(t,"right")}).attr("transform",u.getLinkRTranslate).style("stroke",u.getLinkStroke).style("stroke-width",u.getLinkStrokeWidth),k.select("text").attr("dy",u.getDy).attr("x",u.getLinkTextPositionX).attr("y",function(t){return t.x-t.parent.x}).call(function(t){return t.tween("text",u.getLinkTextTween)}).style("opacity",1);var p=g.exit().transition().duration(n.transitionDuration).remove();p.attr("transform","translate("+t.y+" "+t.x+")");var y={x:t.x,y:t.y,parent:{x:t.x,y:t.y}};p.selectAll("path.link.down").attr("d",function(){return u.getLinkD(y,"down")}),p.selectAll("path.link.right").attr("d",function(){return u.getLinkD(y,"right")}).attr("transform","translate(0 0)"),p.select("text").attr("x",0).attr("y",0).style("opacity",1e-6),l.forEach(function(t){t.x0=t.x,t.y0=t.y})}L.initialize=function(t){a=u,u=(c=t).linkLabelOn?c.linkLabelField:void 0,c.debugOn&&(console.log("oldLabel:"),console.log(a),console.log("newLabel:"),console.log(u))},L.getLinkD=function(t,e){var n=L.getLinkStrength(t.parent,c),i=L.getLinkStrength(t,c),l=void 0;return"down"===e?l="M 0 0V"+(t.x+i/2-t.parent.x):"right"===e&&(l="M 0 0H"+(t.y-(t.parent.y+n/2))),l},L.getDy=function(t){return c.linkLabelOnTop?"0.35em":Math.ceil(-.5*L.getLinkStrength(t)-3)},L.getInitialDy=function(){return m.select(this).attr("dy")?c.linkLabelOnTop?m.select(this).attr("dy").endsWith("em")?m.select(this).attr("dy"):"0.35em":m.select(this).attr("dy").endsWith("em")?0:m.select(this).attr("dy"):null},L.getLinkStrength=function(t){return t.data?c.linkStrengthStatic?c.linkStrengthValue:c.linkStrengthScale(t.data[c.linkStrengthField]):0},L.getLinkStroke=function(t){return c.linkColorStatic?c.defaultColor:c.linkColorScale(t.data[c.linkColorField])},L.getLinkStrokeWidth=function(t){return L.getLinkStrength(t)+"px"},L.getLinkLabel=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.linkLabelField;return c.linkLabelOn?t.data[e]:""},L.getLinkLabelFormatted=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c.linkLabelField;return c.linkLabelOn?c.linkLabelFormat(t.data[e])+c.linkLabelUnit:""},L.getLinkTextTween=function(t){var e=m.select(this);if(!c.linkLabelOn)return function(){e.text("")};var n=L.getLinkLabel(t,a),i=L.getLinkLabel(t,u),l=m.interpolateNumber(n,i);return function(t){e.text(c.linkLabelFormat(l(t))+c.linkLabelUnit)}},L.getLinkRTranslate=function(t){return"translate("+L.getLinkStrength(t.parent)/2+" "+(t.x-t.parent.x)+")"},L.getLinkLabelColor=function(t){return c.linkLabelColor?c.linkLabelColor(L.getLinkLabel(t,a)):m.select(this).style("fill")},L.getLinkTextPositionX=function(t){return c.linkLabelAligned?e[t.depth].posXCenter+e[t.depth].maxX/2:(t.y-t.parent.y)/2},L.computeLabelDimensions=function(t){var a=[];t.each(function(t){var e={},n=m.select(this).node().getBBox().height,i=m.select(this).node().getBBox().width,l=m.select(this).text();a[t.depth]?(a[t.depth].maxX<i&&(a[t.depth].maxX=i,a[t.depth].maxXText=l),a[t.depth].minX>i&&(a[t.depth].minX=i,a[t.depth].posXCenter=(t.y-t.parent.y)/2),a[t.depth].maxY<n&&(a[t.depth].maxY=n,a[t.depth].maxYText=l)):(e.maxX=i,e.minX=i,e.maxY=n,e.maxXText=l,e.maxYText=l,e.posXCenter=(t.y-t.parent.y)/2,a.push(e))}),e=a,c.debugOn&&(console.log("dimensions:"),console.log(a))};var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=function(n){var i={};function l(e){e.each(function(t){(console.log(t),console.log("dataSpec: "),console.log(n),void 0!==t)?a(e,t):r(function(t){var e={};"object"===(void 0===t?"undefined":h(t))?(e.data=t.source,e.hierarchyLevels=t.hierarchyLevels,e.keyField=t.key?t.key:"key",e.delimiter=t.delimiter?t.delimiter:","):console.log("dataspec is not an object!");return e.fromFile=!(!e.data.endsWith(".json")&&!e.data.endsWith(".csv")),e.flatData=!!Array.isArray(e.hierarchyLevels),i.keyField=e.keyField,e}(n),e,i.debugOn,a)})}function a(t,e){g(t,e,i)}return i.debugOn=!1,i.margin={top:20,right:10,bottom:20,left:10},i.svgDimensions={height:800,width:1400},i.maxNameLength=50,i.transitionDuration=750,i.defaultColor="grey",i.linkHeight=20,i.linkLabelField="value",i.linkLabelOn=!1,i.linkLabelUnit="",i.linkLabelOnTop=!0,i.linkLabelAligned=!0,i.locale=void 0,i.linkLabelFormatSpecifier=",.0f",i.linkLabelFormat=m.format(i.linkLabelFormatSpecifier),i.linkWidthStatic=!0,i.linkWidthValue=30,i.linkWidthScale=m.scaleLinear(),i.linkWidthField="value",i.linkWidthRange=[15,100],i.linkStrengthStatic=!0,i.linkStrengthValue=1,i.linkStrengthScale=m.scaleLinear(),i.linkStrengthField="value",i.linkStrengthRange=[1,10],i.linkColorStatic=!0,i.linkColorScale=function(t){return t},i.linkColorField="color",i.propagate=!1,i.propagateField="value",i.alignLeaves=!1,i.keyField="key",l.debugOn=function(t){return arguments.length?(i.debugOn=t,l):i.debugOn},l.defaultColor=function(t){return arguments.length?(i.defaultColor=t,"function"==typeof i.updateLinkColor&&i.updateLinkColor(),l):i.defaultColor},l.margin=function(t){return arguments.length?(i.margin=t,l):i.margin},l.svgDimensions=function(t){return arguments.length?(i.svgDimensions=t,l):i.svgDimensions},l.maxNameLength=function(t){return arguments.length?(i.maxNameLength=t,l):i.maxNameLength},l.transitionDuration=function(t){return arguments.length?(i.transitionDuration=t,l):i.transitionDuration},l.propagateValue=function(t){return arguments.length?(i.propagate=!0,i.propagateField=t,l):i.propagate+": "+i.propagateField},l.formatDefaultLocale=function(t){return arguments.length?("DE"===t&&(t={decimal:",",thousands:".",grouping:[3],currency:[""," €"]}),i.locale=m.formatDefaultLocale(t),l):i.locale},l.linkHeight=function(t){return arguments.length?(i.linkHeight=t,"function"==typeof i.updateDefault&&i.updateDefault(),l):i.linkHeight},l.linkLabel=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkLabelField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("string"==typeof t?(i.linkLabelField=t,i.linkLabelOn=!0):"boolean"==typeof t&&(i.linkLabelOn=t),i.linkLabelOn&&(e.locale&&l.formatDefaultLocale(e.locale),i.linkLabelColor=e.color||i.linkLabelColor,i.linkLabelUnit=e.unit||i.linkLabelUnit,i.linkLabelFormat=e.format?m.format(e.format):i.linkLabelFormat,i.linkLabelOnTop=void 0!==e.onTop?e.onTop:i.linkLabelOnTop,i.linkLabelAligned=void 0!==e.align?e.align:i.linkLabelAligned),"function"==typeof i.updateDefault&&i.updateDefault(),l):i.linkLabelField},l.linkWidth=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkWidthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof t?(i.linkWidthStatic=!0,i.linkWidthValue=t):"string"==typeof t&&(i.linkWidthStatic=!1,i.linkWidthField=t,i.linkWidthScale=e.scale||i.linkWidthScale,i.linkWidthRange=e.range||i.linkWidthRange),"function"==typeof i.updateLinkWidth&&i.updateLinkWidth(),l):i.linkWidthValue},l.linkStrength=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkStrengthField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return arguments.length?("number"==typeof t?(i.linkStrengthStatic=!0,i.linkStrengthValue=t):"string"==typeof t&&(i.linkStrengthStatic=!1,i.linkStrengthField=t,i.linkStrengthScale=e.scale||i.linkStrengthScale,i.linkStrengthRange=e.range||i.linkStrengthRange),"function"==typeof i.updateLinkStrength&&i.updateLinkStrength(),l):i.linkStrengthValue},l.linkColor=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.linkColorField,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:i.linkColorScale;return arguments.length?(i.linkColorStatic=!1,i.linkColorField=t,i.linkColorScale=e,"function"==typeof i.updateDefault&&i.updateDefault(),l):i.linkColorField},l.alignLeaves=function(t){return arguments.length?(i.alignLeaves=t,"function"==typeof i.updateAlignLeaves&&i.updateAlignLeaves(),l):i.alignLeaves},l},Object.defineProperty(t,"__esModule",{value:!0})});